name: Sync package.json version

on:
  push:
    branches:
      - main
      - master

jobs:
  sync-version:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: Install jq
        run: sudo apt-get install jq

      - name: Fetch remote package.json version
        id: remote_version
        run: |
          git fetch origin main
          REMOTE_VERSION=$(git show origin/main:package.json | jq -r .version)
          echo "REMOTE_VERSION=$REMOTE_VERSION" >> $GITHUB_ENV

      - name: Sync local package.json version
        run: |
          jq --arg v "$REMOTE_VERSION" '.version = $v' package.json > package.tmp.json && mv package.tmp.json package.json
