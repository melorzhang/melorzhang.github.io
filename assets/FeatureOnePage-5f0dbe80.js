import{j as e,r as d}from"./react-00db08bf.js";import{F as h,I as z,S as g,c as F,d as C,P as _,B as m,f as b,a as O,g as $,h as G,m as I}from"./antd-e6cfab4a.js";import"./classnames-cee3b7bb.js";import"./rc-util-7b686e84.js";import"./@babel-3e973216.js";import"./react-dom-a3d1ea1f.js";import"./scheduler-765c72db.js";import"./react-is-e5978b8b.js";import"./@ant-design-12de479f.js";import"./@emotion-c0b5c018.js";import"./stylis-9f03583a.js";import"./resize-observer-polyfill-0f9f8adb.js";import"./rc-resize-observer-9b0f7ff6.js";import"./rc-motion-c0cfda94.js";import"./@rc-component-415d57ed.js";import"./rc-overflow-a40a59d2.js";import"./rc-tabs-4292c127.js";import"./rc-dropdown-4787d021.js";import"./rc-menu-d10600ad.js";import"./rc-select-95006f2c.js";import"./rc-virtual-list-2144575c.js";import"./rc-field-form-8e2838d5.js";import"./scroll-into-view-if-needed-448e2d96.js";import"./compute-scroll-into-view-dd0749eb.js";import"./rc-dialog-410aaeda.js";import"./rc-pagination-bbf38588.js";import"./throttle-debounce-87e7e444.js";import"./rc-notification-de8dcb4c.js";import"./rc-tooltip-d1964ef4.js";import"./rc-picker-0bd60a3a.js";import"./rc-textarea-b2d01384.js";import"./rc-input-1f58169b.js";import"./copy-to-clipboard-196009f6.js";import"./toggle-selection-93f4ad84.js";const H=r=>{const o=new Set(r.flatMap(i=>i.category));return Array.from(o)},K=({form:r,isEditing:o,onSubmit:i,optionList:n})=>e.jsxs(h,{form:r,name:"optionForm",onFinish:i,autoComplete:"off",children:[e.jsx(h.Item,{label:"选项内容",name:"content",rules:[{required:!0,message:"请输入选项内容"}],children:e.jsx(z.TextArea,{rows:4,placeholder:"请输入选项内容"})}),e.jsx(h.Item,{label:"选项分类",name:"category",rules:[{required:!0,message:"请输入选项分类"}],children:e.jsx(g,{mode:"tags",style:{width:"100%"},placeholder:"请输入或选择分类，回车可新增",children:H(n).map(l=>e.jsx(g.Option,{value:l,children:l},l))})})]}),Q=({optionList:r,onDelete:o,onEdit:i})=>e.jsxs(e.Fragment,{children:[e.jsx(F,{orientation:"left",children:"选项列表"}),e.jsx(C,{itemLayout:"horizontal",dataSource:r,renderItem:n=>e.jsx(C.Item,{actions:[e.jsx(_,{title:"确定删除?",onConfirm:()=>o(n.id),children:e.jsx(m,{type:"link",danger:!0,children:"删除"})}),e.jsx(m,{type:"link",onClick:()=>i(n.id),children:"编辑"})],children:e.jsx(C.Item.Meta,{title:n.content,description:e.jsx(e.Fragment,{children:n.category.map(l=>e.jsx(b,{color:"green",children:l},l))})})})})]}),{Option:W}=g,v=(r,o)=>r.filter(i=>i.category.includes(o)).length,N=r=>{const o=new Set(r.flatMap(i=>i.category));return Array.from(o)},X=({optionList:r,selectedCategories:o,onCategorySelect:i})=>e.jsxs(e.Fragment,{children:[e.jsx(F,{orientation:"left",children:"选择分类"}),e.jsx(g,{mode:"multiple",style:{width:"100%"},placeholder:"请选择分类",onChange:i,value:o,children:N(r).map(n=>e.jsxs(W,{value:n,children:[n," (",v(r,n),")"]},n))}),e.jsx(F,{orientation:"left",children:"分类统计"}),e.jsx("div",{className:"mb-8",children:N(r).map(n=>e.jsxs(b,{color:"blue",children:[n," (",v(r,n),")"]},n))})]}),Re=()=>{const[r]=h.useForm(),[o,i]=d.useState([]),[n,l]=d.useState(!1),[k,x]=d.useState(""),[L,p]=d.useState(!1),[f,R]=d.useState([]),[j,M]=d.useState(null),[E,T]=d.useState(null);d.useEffect(()=>{const t=localStorage.getItem("optionList");t&&i(JSON.parse(t))},[]);const u=t=>{localStorage.setItem("optionList",JSON.stringify(t))},A=t=>{if(n&&k){const s=o.map(a=>a.id===k?{...a,content:t.content,category:t.category}:a);i(s),u(s)}else{const s={id:Date.now().toString(),content:t.content,category:t.category};i([...o,s]),u([...o,s])}r.resetFields(),l(!1),x(""),p(!1)},D=t=>{const s=o.find(a=>a.id===t);s&&(r.setFieldsValue({content:s.content,category:s.category}),l(!0),x(t),p(!0))},J=t=>{const s=o.filter(a=>a.id!==t);i(s),u(s)},P=t=>{R(t)},B=()=>{if(f.length===0)return;let t=o.filter(c=>c.category.some(y=>f.includes(y)));if(t.length===0)return;E&&t.length>1&&(t=t.filter(c=>c.id!==E));const s=Math.floor(Math.random()*t.length),a=t[s];M(a),T(a.id)},U=()=>{localStorage.removeItem("optionList"),i([]),I.success("缓存已清空")},V=t=>{var a;const s=(a=t.target.files)==null?void 0:a[0];if(s){const c=new FileReader;c.onload=y=>{var w;try{const S=JSON.parse((w=y.target)==null?void 0:w.result);i(S),u(S),I.success("缓存已被文件内容覆盖")}catch{I.error("文件解析失败，请上传有效的 JSON 文件")}},c.readAsText(s)}},q=()=>{const t=JSON.stringify(o,null,2),s="data:application/json;charset=utf-8,"+encodeURIComponent(t),a="option_list.json",c=document.createElement("a");c.setAttribute("href",s),c.setAttribute("download",a),c.click()};return e.jsxs("div",{className:"max-w-4xl mx-auto py-8",children:[e.jsx(O,{title:"选项管理",bordered:!1,className:"mb-8 shadow-lg rounded-xl",children:e.jsxs($,{direction:"vertical",size:"middle",style:{width:"100%"},children:[e.jsx(m,{type:"primary",onClick:()=>{r.resetFields(),l(!1),x(""),p(!0)},children:"添加选项"}),e.jsx(m,{color:"danger",variant:"solid",onClick:U,children:"清空缓存"}),e.jsx(m,{color:"default",variant:"solid",onClick:()=>{var t;return(t=document.getElementById("file-upload"))==null?void 0:t.click()},children:"上传文件覆盖缓存"}),e.jsx("input",{type:"file",id:"file-upload",style:{display:"none"},accept:".json",onChange:V}),e.jsx(m,{color:"cyan",variant:"solid",onClick:q,children:"导出缓存信息"})]})}),e.jsx(X,{optionList:o,selectedCategories:f,onCategorySelect:P}),e.jsx(m,{type:"primary",style:{marginTop:"16px"},onClick:B,children:"随机选择"}),j&&e.jsxs(O,{title:"随机选择结果",bordered:!1,className:"mt-8 shadow-lg rounded-xl",children:[e.jsx("p",{children:j.content}),j.category.map(t=>e.jsx(b,{color:"green",children:t},t))]}),e.jsx(Q,{optionList:o,onDelete:J,onEdit:D}),e.jsx(G,{title:n?"编辑选项":"添加选项",visible:L,onCancel:()=>p(!1),onOk:()=>r.submit(),okText:n?"更新":"添加",children:e.jsx(K,{form:r,isEditing:n,onSubmit:A,optionList:o})})]})};export{Re as default};
